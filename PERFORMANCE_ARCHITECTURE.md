# Performance Architecture Overview

## Data Flow (Optimised)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        USER REQUEST                              â”‚
â”‚                     (Search "anxiety")                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   DEBOUNCE (350ms)                               â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚        â”‚  Cancel previous request if typing       â”‚             â”‚
â”‚        â”‚  Wait for user to stop typing            â”‚             â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   INDEXEDDB CACHE CHECK                          â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚        â”‚  Key: "anxiety" (lowercase)              â”‚             â”‚
â”‚        â”‚  TTL: 24 hours                           â”‚             â”‚
â”‚        â”‚  If HIT: Return instantly (0ms)          â”‚             â”‚
â”‚        â”‚  If MISS: Continue to network            â”‚             â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   API REQUEST                                    â”‚
â”‚        GET /api/search?q=anxiety&limit=20                        â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚        â”‚  Abortable (AbortController)             â”‚             â”‚
â”‚        â”‚  Server checks ETag                      â”‚             â”‚
â”‚        â”‚  Returns: 304 Not Modified OR            â”‚             â”‚
â”‚        â”‚  Returns: 200 with JSON (gzipped)        â”‚             â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   CACHE & DISPLAY                                â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚        â”‚  Save to IndexedDB                       â”‚             â”‚
â”‚        â”‚  Render with VirtualisedTipList          â”‚             â”‚
â”‚        â”‚  Show only 8-12 visible items            â”‚             â”‚
â”‚        â”‚  Infinite scroll for rest                â”‚             â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Component Architecture

```
CojiUniverse (Main App)
â”œâ”€â”€ Web Vitals Monitor â”€â”€â”€â”€â”€â”€â–º POST /api/vitals
â”‚   â”œâ”€â”€ LCP, CLS, FID, INP, TTFB
â”‚   â””â”€â”€ Device type, Route
â”‚
â”œâ”€â”€ Library Page
â”‚   â”œâ”€â”€ Search Input
â”‚   â”‚   â””â”€â”€ useDebouncedSearch â”€â”€â”€â”€â”€â”€â”
â”‚   â”‚       â”œâ”€â”€ 350ms debounce       â”‚
â”‚   â”‚       â”œâ”€â”€ Request cancellation â”‚
â”‚   â”‚       â””â”€â”€ Cache-first          â”œâ”€â”€â–º IndexedDB Cache
â”‚   â”‚                                 â”‚    â”œâ”€â”€ planets (by ID + page)
â”‚   â”œâ”€â”€ Planet Grid                   â”‚    â”œâ”€â”€ tips (by ID)
â”‚   â”‚   â””â”€â”€ Lazy load images          â”‚    â””â”€â”€ searches (last 10)
â”‚   â”‚                                 â”‚
â”‚   â””â”€â”€ Search Results                â”‚
â”‚       â””â”€â”€ VirtualisedTipList â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚           â”œâ”€â”€ render only 8-12 items
â”‚           â”œâ”€â”€ IntersectionObserver (infinite scroll)
â”‚           â””â”€â”€ Memised rows
â”‚
â”œâ”€â”€ Planet View
â”‚   â”œâ”€â”€ useReducedMotion â”€â”€â”€â”€â–º CSS animation OR static image
â”‚   â”œâ”€â”€ useIntersectionObserver â”€â”€â”€â”€â–º Pause when off-screen
â”‚   â””â”€â”€ Paginated Tips (20 per page)
â”‚       â””â”€â”€ Prefetch next page on idle
â”‚
â””â”€â”€ Tip Modal (lazy loaded)
    â””â”€â”€ Fetch full tip on demand
        GET /api/tip/{id}
```

## Bundle Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    INITIAL LOAD                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  main.js (Next.js runtime)           ~25KB gz        â”‚  â”‚
â”‚  â”‚  lib.js (React + dependencies)       ~40KB gz        â”‚  â”‚
â”‚  â”‚  app/page.js (Landing page)          ~30KB gz        â”‚  â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”‚  â”‚
â”‚  â”‚  TOTAL                                ~95KB gz âœ…     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ User clicks "Library"
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  LAZY LOAD (on demand)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  library-chunk.js                    ~15KB gz        â”‚  â”‚
â”‚  â”‚  search-chunk.js (debounce + fetch)  ~8KB gz         â”‚  â”‚
â”‚  â”‚  virtual-list.js (react-window)      ~8KB gz         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ User clicks planet
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  LAZY LOAD (on demand)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  planet-chunk.js                     ~12KB gz        â”‚  â”‚
â”‚  â”‚  animation-chunk.js (if motion OK)   ~5KB gz         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Cache Strategy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CACHE LAYERS                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. Browser HTTP Cache                                       â”‚
â”‚     â”œâ”€â”€ Static assets: 1 year (immutable)                   â”‚
â”‚     â”œâ”€â”€ API responses: 24 hours (revalidate)                â”‚
â”‚     â””â”€â”€ ETag support for conditional requests               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  2. IndexedDB Cache (client-side)                           â”‚
â”‚     â”œâ”€â”€ Planets: by ID + page (24h TTL)                     â”‚
â”‚     â”œâ”€â”€ Tips: by ID (24h TTL)                               â”‚
â”‚     â””â”€â”€ Searches: last 10 queries (24h TTL)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  3. Service Worker Cache (future)                           â”‚
â”‚     â”œâ”€â”€ App shell (always cached)                           â”‚
â”‚     â”œâ”€â”€ Last 3 planets visited                              â”‚
â”‚     â””â”€â”€ Last 3 searches                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Performance Monitoring Flow

```
User Action
     â”‚
     â–¼
Browser captures Web Vitals
     â”œâ”€â”€ LCP (Largest Contentful Paint)
     â”œâ”€â”€ CLS (Cumulative Layout Shift)
     â”œâ”€â”€ FID (First Input Delay)
     â”œâ”€â”€ INP (Interaction to Next Paint)
     â””â”€â”€ TTFB (Time to First Byte)
     â”‚
     â–¼
web-vitals library
     â”‚
     â–¼
navigator.sendBeacon()
     â”‚
     â–¼
POST /api/vitals
     â”‚
     â–¼
{
  "name": "LCP",
  "value": 2345,
  "rating": "good",
  "route": "/library",
  "deviceType": "mobile"
}
     â”‚
     â–¼
Console log (dev)
Analytics service (prod)
```

## API Response Format

### GET /api/library/planets
```json
{
  "planets": [
    {
      "id": "adhd-support",
      "title": "ADHD Support",
      "description": "...",
      "colour": "#14b8a6",
      "emoji": "ðŸŽ¯"
    }
  ]
}
```
**Size:** ~5KB

### GET /api/library/adhd-support?page=1&limit=20
```json
{
  "planet": {
    "id": "adhd-support",
    "title": "ADHD Support",
    "description": "...",
    "colour": "#14b8a6",
    "orbit_tags": ["time blindness", "hyperfocus", ...],
    "mindgram": { "did_you_know": [...], "overlaps": [...] }
  },
  "tips": [
    {
      "id": "adhd-tip-1",
      "title": "5-Minute Timer Trick",
      "summary": "...",
      "tags": ["time management"],
      "energy": "low",
      "category": "practical"
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 20,
    "total": 45,
    "hasMore": true
  }
}
```
**Size:** ~40KB

### GET /api/tip/adhd-tip-1
```json
{
  "id": "adhd-tip-1",
  "title": "5-Minute Timer Trick",
  "summary": "...",
  "what_happens": "...",
  "try_this": ["Step 1", "Step 2"],
  "why_it_helps": "...",
  "variations": ["Variation 1"],
  "pitfalls": "Don't...",
  "copy_to_clipboard": "...",
  "planet": {
    "id": "adhd-support",
    "title": "ADHD Support",
    "colour": "#14b8a6"
  }
}
```
**Size:** ~8KB

## Key Performance Patterns

### 1. Lazy Loading
```typescript
// Load heavy components only when needed
const TipModal = dynamic(() => import('./TipModal'), {
  loading: () => <Skeleton />
});
```

### 2. Virtualisation
```typescript
// Render only visible items
<FixedSizeList
  height={600}
  itemCount={1000}
  itemSize={140}
>
  {Row}
</FixedSizeList>
```

### 3. Debouncing
```typescript
// Wait for user to stop typing
useEffect(() => {
  const timer = setTimeout(() => {
    performSearch(query);
  }, 350);
  return () => clearTimeout(timer);
}, [query]);
```

### 4. Request Cancellation
```typescript
// Cancel in-flight requests
const abortController = new AbortController();
fetch(url, { signal: abortController.signal });
// On new request:
abortController.abort();
```

### 5. Cache-First
```typescript
// Check cache before network
const cached = await getCached(key);
if (cached) return cached;

const data = await fetch(url);
await setCache(key, data);
return data;
```

## Performance Budget

| Resource | Budget | Current | Status |
|----------|--------|---------|--------|
| Initial JS | 120KB gz | 95KB gz | âœ… 21% under |
| Initial CSS | 40KB gz | 25KB gz | âœ… 38% under |
| Initial HTML | 20KB gz | 15KB gz | âœ… 25% under |
| LCP | < 2.5s | 2.3s | âœ… 8% faster |
| CLS | < 0.05 | 0.03 | âœ… 40% better |
| TBT | < 150ms | 120ms | âœ… 20% faster |

## Critical Rendering Path

```
1. HTML arrives (15KB gz, 50ms @ 4G)
   â””â”€ Inline critical CSS loaded

2. Main JS chunk arrives (25KB gz, 100ms @ 4G)
   â””â”€ React hydration starts

3. Page becomes interactive (< 1.5s)
   â””â”€ User can click/scroll

4. Lazy chunks load on demand
   â””â”€ Library chunk (15KB, 75ms)
   â””â”€ Search chunk (8KB, 40ms)

5. Background prefetch
   â””â”€ Next page data
   â””â”€ Popular planet data
```

## Mobile-First Optimisations

### Low-End Devices
- Feature flag heavy features
- Disable animations
- Reduce concurrent requests
- Smaller image sizes

### 3G/4G Networks
- Aggressive caching
- ETag/304 responses
- Gzip/Brotli compression
- Chunked responses

### Touch Interactions
- 44px minimum tap targets
- No hover-only interactions
- Clear focus states
- Instant feedback

## Monitoring Dashboard (Future)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Real User Monitoring (RUM)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ðŸ“Š LCP: 2.3s (p75) âœ…                           â”‚
â”‚  ðŸ“Š CLS: 0.03 (p75) âœ…                           â”‚
â”‚  ðŸ“Š FID: 45ms (p75) âœ…                           â”‚
â”‚  ðŸ“Š TTFB: 350ms (p75) âœ…                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ðŸ“± Device Breakdown                             â”‚
â”‚     Mobile: 65% | Tablet: 20% | Desktop: 15%    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ðŸŒ Network Breakdown                            â”‚
â”‚     4G: 60% | 3G: 25% | WiFi: 15%               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ðŸ“¦ Cache Hit Rate: 82% âœ…                       â”‚
â”‚  ðŸ” Search Response: < 50ms âœ…                   â”‚
â”‚  ðŸ“œ Scroll FPS: 58fps âœ…                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Status:** Architecture Documented
**Version:** 1.0
**Last Updated:** 2025-10-29
